---
title: "Experiment of CL-Eigenwords"
author: "OSHIKIRI Takamasa"
date: "`r Sys.time()`"
output: html_document
---

```{r, include = FALSE}
time.begin <- Sys.time()

source("./../src/kadingir.R", chdir = TRUE)
source("./../src/cleigenwords.R", chdir = TRUE)
```

```{r}
paths.corpus <- c("./../data/europarl/europarl-v7.es-en.es.tokenized",
                  "./../data/europarl/europarl-v7.es-en.en.tokenized")

r <- CLEigenwords(paths.corpus, sizes.vocabulary = c(10000, 10000),
                  dim.common = 400,
                  sizes.window = c(2, 2), aliases.languages=c("es", "en"),
                  plot = TRUE,
                  weighting_tf = FALSE,
                  weight.vsdoc = 1e6 * c(1.0, 1.0),
                  rate.sample.chunk = 0.1, size.chunk = 10000)

save(r, file = "res_cleigenwords.Rdata")
```


```{r}
p <- r$svd$p_head_domains
V1 <- r$svd$V[p[1]:p[2], ]
V2 <- r$svd$V[(p[3]+1):p[4], ]
vocab.words1 <- paste0("(es)", r$vocab.words[[1]])
vocab.words2 <- paste0("(en)", r$vocab.words[[2]])

V <- rbind(V1, V2)
vocab.words <- c(vocab.words1, vocab.words2)
```

```{r}
r$svd$V[c(p[1], p[2]+1, p[3]+1, p[4]+1, p[5]+1), 1:20]
```

## Plot some figure
```{r}
queries <- c(paste0("(en)", c("i", "you", "he", "she", "my", "your", "her")),
             paste0("(es)", c("yo", "tu", "él", "ella", "mi", "su")))
n.queries <- length(queries)

VV <- V
row.names(VV) <- vocab.words
pr.v2 <- prcomp(VV[queries,])
plot(pr.v2$x[ , 1:2], pch = 1, col = "grey")
text(pr.v2$x[ , 1], pr.v2$x[ , 2], row.names(pr.v2$x))
```

# 類似単語の検索
(en)I = (es)yo

```{r}
MostSimilar(V, vocab.words, positive=c("(en)we"), distance = "cosine", language.search = "en")
MostSimilar(V, vocab.words, positive=c("(en)we"), distance = "cosine", language.search = "es")
MostSimilar(V, vocab.words, positive=c("(es)yo"), distance = "cosine", language.search = "en")
MostSimilar(V, vocab.words, positive=c("(es)yo"), distance = "cosine", language.search = "es")
MostSimilar(V, vocab.words, positive=c("(en)him", "(es)yo"), negative=c("(en)he"), distance = "cosine")
```

# 英語の単語ベクトルについてのタスクを試す
```{r}
TestGoogleTasks(r$svd$V[(p[3]+1):p[4], ], r$vocab.words[[2]], n.cores = 12)
TestWordsim353(r$svd$V[(p[3]+1):p[4], ], r$vocab.words[[2]])
```

```{r}
Sys.time() - time.begin
Sys.time()
```